<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Node.js Async Capabilities</title>
    <link rel="stylesheet" href="/scripts/assets/css/script_styles.css">
</head>
<body>
    <div class="container">
        <div class="header nodejs">
            <h1>
                <svg class="language-logo" viewBox="0 0 24 24" width="48" height="48">
                    <path fill="#43853d" d="M12,1.85C11.73,1.85 11.45,1.92 11.22,2.05L3.78,6.35C3.3,6.63 3,7.15 3,7.71V16.29C3,16.85 3.3,17.37 3.78,17.65L5.73,18.77C6.68,19.23 7,19.24 7.44,19.24C8.84,19.24 9.65,18.39 9.65,16.91V8.44C9.65,8.32 9.55,8.22 9.43,8.22H8.5C8.37,8.22 8.27,8.32 8.27,8.44V16.91C8.27,17.57 7.59,18.22 6.5,17.67L4.45,16.5C4.38,16.45 4.34,16.37 4.34,16.29V7.71C4.34,7.62 4.38,7.54 4.45,7.5L11.89,3.21C11.95,3.17 12.05,3.17 12.11,3.21L19.55,7.5C19.62,7.54 19.66,7.62 19.66,7.71V16.29C19.66,16.37 19.62,16.45 19.55,16.5L12.11,20.79C12.05,20.83 11.95,20.83 11.88,20.79L10,19.65C9.92,19.62 9.84,19.61 9.79,19.64C9.26,19.94 9.16,20 8.67,20.15C8.55,20.19 8.36,20.26 8.74,20.47L11.22,21.94C11.46,22.08 11.72,22.15 12,22.15C12.28,22.15 12.54,22.08 12.78,21.94L20.22,17.65C20.7,17.37 21,16.85 21,16.29V7.71C21,7.15 20.7,6.63 20.22,6.35L12.78,2.05C12.55,1.92 12.28,1.85 12,1.85M14,8C11.88,8 10.61,8.89 10.61,10.39C10.61,12 11.87,12.47 13.91,12.67C16.34,12.91 16.53,13.27 16.53,13.75C16.53,14.58 15.86,14.93 14.3,14.93C12.32,14.93 11.9,14.44 11.75,13.46C11.73,13.36 11.64,13.28 11.53,13.28H10.57C10.45,13.28 10.36,13.37 10.36,13.5C10.36,14.74 11.04,16.24 14.3,16.24C16.65,16.24 18,15.31 18,13.69C18,12.08 16.92,11.66 14.63,11.41C12.32,11.16 12.09,11.02 12.09,10.5C12.09,10.14 12.22,9.66 14,9.66C15.5,9.66 16.09,10.05 16.32,11.07C16.34,11.18 16.43,11.25 16.54,11.25H17.5C17.55,11.25 17.61,11.23 17.65,11.19C17.69,11.15 17.72,11.08 17.7,11.04C17.56,9.72 16.75,8 14,8Z"/>
                </svg>
                Node.js Async Capabilities
            </h1>
            <p>Demonstrating asynchronous features and modern JavaScript</p>
        </div>

        <div class="card">
            <h2>System Information</h2>
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">Node.js Version</div>
                    <div id="node-version" class="info-value">Loading...</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Platform</div>
                    <div id="platform" class="info-value">Loading...</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Architecture</div>
                    <div id="architecture" class="info-value">Loading...</div>
                </div>
                <div class="info-item">
                    <div class="info-label">CPU Cores</div>
                    <div id="cpu-cores" class="info-value">Loading...</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Total Memory</div>
                    <div id="total-memory" class="info-value">Loading...</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Free Memory</div>
                    <div id="free-memory" class="info-value">Loading...</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>API Status Simulation</h2>
            <table id="api-status">
                <thead>
                    <tr>
                        <th>Service</th>
                        <th>Status</th>
                        <th>Response Time</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="3">Loading API status...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="card">
            <h2>Modern JavaScript Features</h2>
            <div id="features-container"></div>
        </div>

        <div class="card">
            <h2>Code Examples</h2>
            <div class="code-tabs" id="code-tabs"></div>
            <div id="code-containers"></div>
        </div>

        <div class="card">
            <h2>Live Demo</h2>
            <div class="timer">
                <p>Time since page loaded:</p>
                <div id="timer" class="time">0 seconds</div>
            </div>
        </div>

        <div class="footer">
            <p>Generated by the WebServ CGI Handler - Running Node.js</p>
            <p>Demonstrating Node.js asynchronous capabilities and modern JavaScript features</p>
        </div>
    </div>

    <script src="/scripts/assets/js/script_common.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Load data from Node.js script
            fetch('/scripts/nodejs/async_demo.js')
                .then(response => response.text())
                .then(html => {
                    // Create a temporary element to parse the HTML
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = html;
                    
                    try {
                        // First try to find JSON data in the response
                        const jsonStart = html.indexOf('{');
                        const jsonEnd = html.lastIndexOf('}') + 1;
                        
                        if (jsonStart > -1 && jsonEnd > jsonStart) {
                            const jsonStr = html.substring(jsonStart, jsonEnd);
                            const data = JSON.parse(jsonStr);
                            
                            // Update system info
                            document.getElementById('node-version').textContent = data.systemInfo.nodeVersion;
                            document.getElementById('platform').textContent = data.systemInfo.platform;
                            document.getElementById('architecture').textContent = data.systemInfo.arch;
                            document.getElementById('cpu-cores').textContent = data.systemInfo.cpuCores;
                            document.getElementById('total-memory').textContent = data.systemInfo.totalMemory;
                            document.getElementById('free-memory').textContent = data.systemInfo.freeMemory;
                            
                            // Update API status table
                            const tbody = document.querySelector('#api-status tbody');
                            tbody.innerHTML = data.apiData.map(api => `
                                <tr>
                                    <td>${api.name}</td>
                                    <td><span class="status-badge status-${api.status.toLowerCase()}">${api.status}</span></td>
                                    <td>${api.response}</td>
                                </tr>
                            `).join('');
                            
                            // Update features
                            const featuresContainer = document.getElementById('features-container');
                            featuresContainer.innerHTML = data.technologies.map(tech => `
                                <div class="feature-item">
                                    <div class="feature-icon">
                                        <svg width="22" height="22" viewBox="0 0 24 24">
                                            <path fill="var(--nodejs-green)" d="M12,1.85C11.73,1.85 11.45,1.92 11.22,2.05L3.78,6.35C3.3,6.63 3,7.15 3,7.71V16.29C3,16.85 3.3,17.37 3.78,17.65L5.73,18.77C6.68,19.23 7,19.24 7.44,19.24C8.84,19.24 9.65,18.39 9.65,16.91V8.44C9.65,8.32 9.55,8.22 9.43,8.22H8.5C8.37,8.22 8.27,8.32 8.27,8.44V16.91C8.27,17.57 7.59,18.22 6.5,17.67L4.45,16.5C4.38,16.45 4.34,16.37 4.34,16.29V7.71C4.34,7.62 4.38,7.54 4.45,7.5L11.89,3.21C11.95,3.17 12.05,3.17 12.11,3.21L19.55,7.5C19.62,7.54 19.66,7.62 19.66,7.71V16.29C19.66,16.37 19.62,16.45 19.55,16.5L12.11,20.79C12.05,20.83 11.95,20.83 11.88,20.79L10,19.65C9.92,19.62 9.84,19.61 9.79,19.64C9.26,19.94 9.16,20 8.67,20.15C8.55,20.19 8.36,20.26 8.74,20.47L11.22,21.94C11.46,22.08 11.72,22.15 12,22.15C12.28,22.15 12.54,22.08 12.78,21.94L20.22,17.65C20.7,17.37 21,16.85 21,16.29V7.71C21,7.15 20.7,6.63 20.22,6.35L12.78,2.05C12.55,1.92 12.28,1.85 12,1.85Z"/>
                                        </svg>
                                    </div>
                                    <div class="feature-text">
                                        <div class="feature-name">${tech.name}</div>
                                        <div class="feature-desc">${tech.description}</div>
                                    </div>
                                </div>
                            `).join('');
                            
                            // Update code examples
                            const codeTabs = document.getElementById('code-tabs');
                            const codeContainers = document.getElementById('code-containers');
                            
                            codeTabs.innerHTML = data.codeExamples.map((example, index) => `
                                <div class="code-tab ${index === 0 ? 'active' : ''}" data-tab="${index}">
                                    ${example.title}
                                </div>
                            `).join('');
                            
                            codeContainers.innerHTML = data.codeExamples.map((example, index) => `
                                <div class="code-container" id="code-${index}" style="display: ${index === 0 ? 'block' : 'none'}">
                                    <code>${example.code}</code>
                                </div>
                            `).join('');
                            
                            // Set up code tab functionality
                            document.querySelectorAll('.code-tab').forEach(tab => {
                                tab.addEventListener('click', () => {
                                    const tabId = tab.getAttribute('data-tab');
                                    document.querySelectorAll('.code-tab').forEach(t => t.classList.remove('active'));
                                    document.querySelectorAll('.code-container').forEach(c => c.style.display = 'none');
                                    tab.classList.add('active');
                                    document.getElementById('code-' + tabId).style.display = 'block';
                                });
                            });
                        }
                    } catch (error) {
                        console.error('Error parsing response:', error);
                    }
                })
                .catch(error => {
                    console.error('Error loading Node.js script:', error);
                });

            // Update timer
            let seconds = 0;
            setInterval(() => {
                seconds++;
                document.getElementById('timer').textContent = seconds + ' seconds';
            }, 1000);
        });
    </script>
</body>
</html>