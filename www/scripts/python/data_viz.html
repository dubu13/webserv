<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Data Visualization</title>
    <link rel="stylesheet" href="/scripts/assets/css/script_styles.css">
    <style>
        /* Additional Python-specific styles */
        .chart-canvas {
            width: 100%;
            height: 300px;
            border: 1px solid var(--light-border);
            background-color: white;
            margin: 15px 0;
        }
        
        .progress-bar {
            height: 25px;
            background-color: #dfe6e9;
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-value {
            height: 100%;
            background: linear-gradient(to right, var(--python-color), #FFD43B);
            display: flex;
            align-items: center;
            padding-left: 10px;
            color: white;
            font-weight: bold;
            transition: width 0.5s;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header python">
            <h1>
                <svg class="language-logo" viewBox="0 0 256 255" width="48" height="48">
                    <path d="M126.916 0c-8.941 0-17.548 0.8-25.075 2.227-22.214 4.16-26.22 12.869-26.22 28.91v21.213h52.44v6.628h-52.44-19.687c-16.12 0-30.246 9.687-34.665 28.115-5.095 21.077-5.318 34.208 0 56.219 3.948 16.357 13.375 28.115 29.48 28.115h19.075v-25.337c0-18.295 15.825-34.445 34.675-34.445h52.371c15.45 0 27.7-12.728 27.7-28.267V31.138c0-15.09-12.736-26.438-27.7-28.91C148.17 0.8 135.857 0 126.916 0ZM98.821 17.012c5.42 0 9.856 4.502 9.856 10.031 0 5.521-4.436 9.99-9.856 9.99-5.448 0-9.856-4.469-9.856-9.99 0-5.529 4.408-10.031 9.856-10.031Z" fill="#306998"/>
                    <path d="M195.049 59.856v24.617c0 19.096-16.18 35.152-34.675 35.152h-52.371c-15.183 0-27.7 12.993-27.7 28.267v52.953c0 15.09 13.123 23.967 27.7 28.267 17.47 5.15 34.175 6.079 52.371 0 12.086-4.022 27.7-12.109 27.7-28.267v-21.213h-52.371v-6.628h52.371 27.7c16.115 0 22.125-11.237 27.709-28.092 5.775-17.303 5.525-33.958 0-56.24-3.966-16.-11.567-28.055-27.71-28.055h-20.423Zm-34.302 133.215c5.448 0 9.856 4.469 9.856 9.99 0 5.529-4.408 10.031-9.856 10.031-5.42 0-9.856-4.502-9.856-10.031 0-5.521 4.437-9.99 9.856-9.99Z" fill="#FFD43B"/>
                </svg>
                Python Data Visualization
            </h1>
            <p>Interactive data processing and visualization using Python</p>
        </div>
        
        <div class="card">
            <h2>System Information</h2>
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">Python Version</div>
                    <div id="python-version" class="info-value">Loading...</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Operating System</div>
                    <div id="os" class="info-value">Loading...</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Hostname</div>
                    <div id="hostname" class="info-value">Loading...</div>
                </div>
                <div class="info-item">
                    <div class="info-label">CPU Cores</div>
                    <div id="cpu-cores" class="info-value">Loading...</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Current Time</div>
                    <div id="current-time" class="info-value">Loading...</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Platform</div>
                    <div id="platform" class="info-value">Loading...</div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>Data Analysis</h2>
            
            <h3>Sample Dataset</h3>
            <div class="terminal">
                <pre id="sample-data">Loading...</pre>
            </div>
            
            <h3>Data Visualization</h3>
            
            <div id="chart-container" class="chart-canvas">
                <p style="text-align: center; padding-top: 120px;">Loading chart...</p>
            </div>
            
            <h4>Category Distribution</h4>
            <div id="category-stats">
                <div class="category-item">
                    <div class="category-name">Category A</div>
                    <div class="progress-bar">
                        <div class="progress-value" style="width: 0%">0%</div>
                    </div>
                </div>
                <div class="category-item">
                    <div class="category-name">Category B</div>
                    <div class="progress-bar">
                        <div class="progress-value" style="width: 0%">0%</div>
                    </div>
                </div>
                <div class="category-item">
                    <div class="category-name">Category C</div>
                    <div class="progress-bar">
                        <div class="progress-value" style="width: 0%">0%</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>Data Processing with Python</h2>
            
            <h3>Statistical Analysis</h3>
            <table id="stats-table">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Mean</td>
                        <td id="stat-mean">Loading...</td>
                    </tr>
                    <tr>
                        <td>Median</td>
                        <td id="stat-median">Loading...</td>
                    </tr>
                    <tr>
                        <td>Standard Deviation</td>
                        <td id="stat-std">Loading...</td>
                    </tr>
                    <tr>
                        <td>Min</td>
                        <td id="stat-min">Loading...</td>
                    </tr>
                    <tr>
                        <td>Max</td>
                        <td id="stat-max">Loading...</td>
                    </tr>
                    <tr>
                        <td>Total Count</td>
                        <td id="stat-count">Loading...</td>
                    </tr>
                </tbody>
            </table>
            
            <h3>Python Code Example</h3>
            <div class="code-block">
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

# Generate sample data
np.random.seed(42)
data = np.random.normal(100, 20, size=200)

# Calculate statistics
stats = {
    "mean": np.mean(data),
    "median": np.median(data),
    "std": np.std(data),
    "min": np.min(data),
    "max": np.max(data),
    "count": len(data)
}

# Create categorical data
categories = ['A', 'B', 'C']
cat_counts = np.random.randint(50, 150, size=3)
cat_data = pd.Series(cat_counts, index=categories)
cat_pcts = cat_data / cat_data.sum() * 100

# Visualize data
plt.figure(figsize=(10, 6))
plt.hist(data, bins=20, color='skyblue', edgecolor='black')
plt.axvline(stats["mean"], color='red', linestyle='dashed', linewidth=1)
plt.title('Data Distribution')
plt.xlabel('Value')
plt.ylabel('Frequency')
plt.savefig('histogram.png')
            </div>
        </div>
        
        <div class="card">
            <h2>Interactive Data Exploration</h2>
            <p>Try different parameters to explore the data distribution:</p>
            
            <div class="controls">
                <label for="sample-size">Sample Size:</label>
                <input type="range" id="sample-size" min="50" max="500" value="200" step="50">
                <span id="sample-size-value">200</span>
                
                <label for="mean-value">Mean Value:</label>
                <input type="range" id="mean-value" min="50" max="150" value="100" step="5">
                <span id="mean-value-value">100</span>
                
                <label for="std-value">Standard Deviation:</label>
                <input type="range" id="std-value" min="5" max="40" value="20" step="5">
                <span id="std-value-value">20</span>
                
                <button id="generate-btn">Generate New Data</button>
            </div>
            
            <div id="interactive-chart" class="chart-canvas">
                <p style="text-align: center; padding-top: 120px;">Click the button to generate data...</p>
            </div>
        </div>
        
        <div class="footer">
            <p>Generated by the WebServ CGI Handler - Running Python</p>
            <p>An example of separating content (Python), presentation (HTML/CSS), and behavior (JavaScript)</p>
        </div>
    </div>

    <script src="/scripts/assets/js/script_common.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Load data from Python script
            fetch('/scripts/python/data_viz.py')
                .then(response => response.text())
                .then(html => {
                    // Create a temporary element to parse the HTML
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = html;
                    
                    // Parse JSON data if available
                    try {
                        // First, try to find JSON data in the response
                        const jsonStart = html.indexOf('{');
                        const jsonEnd = html.lastIndexOf('}') + 1;
                        
                        if (jsonStart > -1 && jsonEnd > jsonStart) {
                            const jsonStr = html.substring(jsonStart, jsonEnd);
                            const data = JSON.parse(jsonStr);
                            
                            // Update system info
                            document.getElementById('python-version').textContent = data.system_info.python_version;
                            document.getElementById('os').textContent = data.system_info.platform;
                            document.getElementById('hostname').textContent = data.system_info.hostname;
                            document.getElementById('cpu-cores').textContent = data.system_info.cpu_cores;
                            document.getElementById('current-time').textContent = data.system_info.time;
                            document.getElementById('platform').textContent = data.system_info.platform;
                            
                            // Update sample data
                            document.getElementById('sample-data').textContent = data.sample_data;
                            
                            // Update statistics
                            document.getElementById('stat-mean').textContent = data.stats.mean.toFixed(2);
                            document.getElementById('stat-median').textContent = data.stats.median.toFixed(2);
                            document.getElementById('stat-std').textContent = data.stats.std.toFixed(2);
                            document.getElementById('stat-min').textContent = data.stats.min.toFixed(2);
                            document.getElementById('stat-max').textContent = data.stats.max.toFixed(2);
                            document.getElementById('stat-count').textContent = data.stats.count;
                            
                            // Update category progress bars
                            const categoryItems = document.querySelectorAll('.category-item');
                            data.categories.forEach((category, index) => {
                                if (index < categoryItems.length) {
                                    const item = categoryItems[index];
                                    const nameElem = item.querySelector('.category-name');
                                    const progressBar = item.querySelector('.progress-value');
                                    
                                    nameElem.textContent = category.name;
                                    progressBar.style.width = category.percentage + '%';
                                    progressBar.textContent = category.percentage.toFixed(1) + '%';
                                }
                            });
                            
                            // Create chart
                            createChart(data.histogram);
                        } else {
                            // Fallback to extracting from HTML elements
                            extractDataFromHtml(tempDiv);
                        }
                    } catch (error) {
                        console.error('Error parsing JSON data:', error);
                        // Fallback to extracting from HTML elements
                        extractDataFromHtml(tempDiv);
                    }
                })
                .catch(error => {
                    console.error('Error loading Python script:', error);
                });
                
            // Set up interactive controls
            const sampleSizeInput = document.getElementById('sample-size');
            const sampleSizeValue = document.getElementById('sample-size-value');
            const meanValueInput = document.getElementById('mean-value');
            const meanValueValue = document.getElementById('mean-value-value');
            const stdValueInput = document.getElementById('std-value');
            const stdValueValue = document.getElementById('std-value-value');
            const generateBtn = document.getElementById('generate-btn');
            
            sampleSizeInput.addEventListener('input', function() {
                sampleSizeValue.textContent = this.value;
            });
            
            meanValueInput.addEventListener('input', function() {
                meanValueValue.textContent = this.value;
            });
            
            stdValueInput.addEventListener('input', function() {
                stdValueValue.textContent = this.value;
            });
            
            let interactiveChart = null;
            
            generateBtn.addEventListener('click', function() {
                const sampleSize = parseInt(sampleSizeInput.value);
                const meanValue = parseInt(meanValueInput.value);
                const stdValue = parseInt(stdValueInput.value);
                
                // Simple data generation and visualization on the client side
                // In a real app, this would call back to a Python endpoint
                generateData(sampleSize, meanValue, stdValue);
            });
        });
        
        // Fallback function to extract data from HTML
        function extractDataFromHtml(container) {
            document.getElementById('python-version').textContent = 
                container.querySelector('#python-version') ? 
                container.querySelector('#python-version').textContent : '3.10.0';
            
            document.getElementById('os').textContent = 
                container.querySelector('#os') ? 
                container.querySelector('#os').textContent : 'Linux';
                
            document.getElementById('hostname').textContent = 
                container.querySelector('#hostname') ? 
                container.querySelector('#hostname').textContent : 'webserv';
                
            document.getElementById('cpu-cores').textContent = 
                container.querySelector('#cpu-cores') ? 
                container.querySelector('#cpu-cores').textContent : '4';
                
            document.getElementById('current-time').textContent = 
                container.querySelector('#current-time') ? 
                container.querySelector('#current-time').textContent : 
                new Date().toISOString();
                
            document.getElementById('platform').textContent = 
                container.querySelector('#platform') ? 
                container.querySelector('#platform').textContent : 'linux';
                
            // Use default data for the chart
            const defaultData = {
                labels: Array.from({length: 20}, (_, i) => (i * 10 + 50)),
                values: [2, 5, 8, 12, 18, 22, 25, 20, 18, 15, 12, 10, 8, 6, 5, 3, 2, 1, 1, 0]
            };
            
            createChart(defaultData);
        }
        
        // Create chart function
        function createChart(histData) {
            const ctx = document.getElementById('chart-container');
            
            // Clear any previous chart
            ctx.innerHTML = '';
            ctx.style.padding = '0';
            
            // Create canvas element
            const canvas = document.createElement('canvas');
            ctx.appendChild(canvas);
            
            // Create chart
            new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: histData.labels,
                    datasets: [{
                        label: 'Frequency',
                        data: histData.values,
                        backgroundColor: '#3498db',
                        borderColor: '#2980b9',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Frequency'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Value'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Data Distribution'
                        }
                    }
                }
            });
        }
        
        // Generate data for interactive chart
        function generateData(sampleSize, mean, stdDev) {
            // Simple normal distribution approximation with Box-Muller transform
            function generateNormalRandom() {
                let u = 0, v = 0;
                while (u === 0) u = Math.random();
                while (v === 0) v = Math.random();
                const z = Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
                return z * stdDev + mean;
            }
            
            // Generate data points
            const data = Array.from({length: sampleSize}, generateNormalRandom);
            
            // Create histogram
            const min = Math.min(...data);
            const max = Math.max(...data);
            const binCount = 20;
            const binWidth = (max - min) / binCount;
            
            // Initialize bins
            const bins = Array(binCount).fill(0);
            const binLabels = Array.from({length: binCount}, (_, i) => 
                Math.round(min + i * binWidth + binWidth / 2));
            
            // Fill bins
            data.forEach(value => {
                const binIndex = Math.min(Math.floor((value - min) / binWidth), binCount - 1);
                bins[binIndex]++;
            });
            
            // Calculate statistics
            const sum = data.reduce((a, b) => a + b, 0);
            const dataMean = sum / data.length;
            const varianceSum = data.reduce((a, b) => a + Math.pow(b - dataMean, 2), 0);
            const variance = varianceSum / data.length;
            const dataStd = Math.sqrt(variance);
            
            // Sort for median
            const sortedData = [...data].sort((a, b) => a - b);
            const dataMedian = data.length % 2 === 0 ? 
                (sortedData[data.length / 2 - 1] + sortedData[data.length / 2]) / 2 : 
                sortedData[Math.floor(data.length / 2)];
            
            // Update statistics
            document.getElementById('stat-mean').textContent = dataMean.toFixed(2);
            document.getElementById('stat-median').textContent = dataMedian.toFixed(2);
            document.getElementById('stat-std').textContent = dataStd.toFixed(2);
            document.getElementById('stat-min').textContent = Math.min(...data).toFixed(2);
            document.getElementById('stat-max').textContent = Math.max(...data).toFixed(2);
            document.getElementById('stat-count').textContent = data.length;
            
            // Create chart
            const ctx = document.getElementById('interactive-chart');
            
            // Clear any previous chart
            ctx.innerHTML = '';
            ctx.style.padding = '0';
            
            // Create canvas element
            const canvas = document.createElement('canvas');
            ctx.appendChild(canvas);
            
            // Create chart
            new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: binLabels,
                    datasets: [{
                        label: 'Frequency',
                        data: bins,
                        backgroundColor: '#9b59b6',
                        borderColor: '#8e44ad',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Frequency'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Value'
                            },
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Generated Data Distribution'
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>